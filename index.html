<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doodle Jump Deluxe</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
  <style>
    body { margin: 0; background: #000; overflow: hidden; }
    canvas { display: block; margin: auto; }
  </style>
</head>
<body>
<script>
let score = 0;
let scoreText, highscore = 0;
let platforms;
let player;
let gameStarted = false;

const config = {
    type: Phaser.AUTO,
    width: 360,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: { gravity: { y: 600 }, debug: false }
    },
    scene: {
        preload, create, update
    }
};

new Phaser.Game(config);

function preload() {
    this.load.image('bg', 'https://i.ibb.co/kxBmqLk/bg-stars.jpg');
    this.load.image('platform', 'https://i.ibb.co/MgW0DF3/grass.png');
    this.load.image('player', 'https://i.ibb.co/yyc1xGL/hero.png');
    this.load.audio('jump', 'https://opengameart.org/sites/default/files/jump_11.wav');
}

function create() {
    this.add.image(180, 300, 'bg').setScale(1.2);

    platforms = this.physics.add.staticGroup();
    for (let i = 100; i < 600; i += 100) {
        platforms.create(Phaser.Math.Between(20, 320), i, 'platform').setScale(0.5).refreshBody();
    }

    player = this.physics.add.sprite(180, 500, 'player').setScale(0.25);
    player.setCollideWorldBounds(true);
    player.body.setBounce(0.2);

    this.physics.add.collider(player, platforms, () => {
        if (player.body.velocity.y > 0) {
            player.setVelocityY(-400);
            this.sound.play('jump');
        }
    });

    scoreText = this.add.text(10, 10, 'Score: 0', { fontSize: '18px', fill: '#fff' });

    // Главное меню
    this.menuText = this.add.text(60, 250, 'DOODLE JUMP DELUXE\n\nНажми любую клавишу', {
        fontSize: '20px',
        fill: '#ffffff',
        align: 'center'
    }).setOrigin(0).setDepth(1);

    this.input.keyboard.once('keydown', () => {
        gameStarted = true;
        this.menuText.destroy();
    });

    this.cursors = this.input.keyboard.createCursorKeys();
}

function update() {
    if (!gameStarted) return;

    if (this.cursors.left.isDown) {
        player.setVelocityX(-200);
    } else if (this.cursors.right.isDown) {
        player.setVelocityX(200);
    } else {
        player.setVelocityX(0);
    }

    // Прокрутка и очки
    if (player.y < 300) {
        platforms.children.iterate(p => {
            p.y += 4;
            if (p.y > 600) {
                p.y = 0;
                p.x = Phaser.Math.Between(20, 320);
                score += 10;
                scoreText.setText('Score: ' + score);
                if (score > highscore) {
                    highscore = score;
                    localStorage.setItem('highscore', highscore);
                }
            }
        });
    }

    // Game Over
    if (player.y > 620) {
        const hs = localStorage.getItem('highscore') || 0;
        alert('Game Over!\nСчёт: ' + score + '\nРекорд: ' + hs);
        location.reload();
    }
}
</script>
</body>
</html>
